<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>GIS程序设计 知识总结 | Programmer Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="GIS程序设计简答1. 开发模式，开发软件的特点，概念 独立开发： 定义：不依赖于任何GIS工具软件，从空间数据的采集、编辑到数据的处理分析及结果输出，所有的算法都由开发者独立设计，然后选用某种程序设计语言，如VC++、VB、Delphi、C++ Builder等，在一定的操作系统平台上编程实现。 特点： 无需依赖任何商业GIS工具软件，减少了开发成本 综合程度和操作效率最高     单纯二次开发">
<meta property="og:type" content="article">
<meta property="og:title" content="GIS程序设计 知识总结">
<meta property="og:url" content="http://example.com/2021/07/22/GIS%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%20%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="Programmer Home">
<meta property="og:description" content="GIS程序设计简答1. 开发模式，开发软件的特点，概念 独立开发： 定义：不依赖于任何GIS工具软件，从空间数据的采集、编辑到数据的处理分析及结果输出，所有的算法都由开发者独立设计，然后选用某种程序设计语言，如VC++、VB、Delphi、C++ Builder等，在一定的操作系统平台上编程实现。 特点： 无需依赖任何商业GIS工具软件，减少了开发成本 综合程度和操作效率最高     单纯二次开发">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20191106115227332.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RhbkJvX0M=,size_16,color_FFFFFF,t_70">
<meta property="article:published_time" content="2021-07-22T09:54:48.917Z">
<meta property="article:modified_time" content="2020-04-12T13:48:47.472Z">
<meta property="article:author" content="Eno·feng">
<meta property="article:tag" content="Code, 代码, 程序, GIS, js, 前端, vue, node">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20191106115227332.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RhbkJvX0M=,size_16,color_FFFFFF,t_70">
  
    <link rel="alternate" href="/atom.xml" title="Programmer Home" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Programmer Home</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Learn and Life</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-GIS程序设计 知识总结" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/22/GIS%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%20%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2021-07-22T09:54:48.917Z" itemprop="datePublished">2021-07-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      GIS程序设计 知识总结
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="GIS程序设计"><a href="#GIS程序设计" class="headerlink" title="GIS程序设计"></a>GIS程序设计</h1><h2 id="简答"><a href="#简答" class="headerlink" title="简答"></a>简答</h2><h4 id="1-开发模式，开发软件的特点，概念"><a href="#1-开发模式，开发软件的特点，概念" class="headerlink" title="1. 开发模式，开发软件的特点，概念"></a>1. 开发模式，开发软件的特点，概念</h4><ol>
<li>独立开发：<ul>
<li>定义：不依赖于任何GIS工具软件，从空间数据的采集、编辑到数据的处理分析及结果输出，所有的算法都由开发者独立设计，然后选用某种程序设计语言，如VC++、VB、Delphi、C++ Builder等，在一定的操作系统平台上编程实现。</li>
<li>特点：<ul>
<li>无需依赖任何商业GIS工具软件，减少了开发成本</li>
<li>综合程度和操作效率最高</li>
</ul>
</li>
</ul>
</li>
<li>单纯二次开发：<ul>
<li>定义：在宏语言中调用DLL库，定义GIS系统工具不提供或不支持的功能，</li>
<li>特点：<ul>
<li>功能弱，程序不美观，开发收到限制</li>
<li>增加学习负担</li>
</ul>
</li>
</ul>
</li>
<li>集成二次开发：<ul>
<li>定义：利用专业GIS工具软件或其提供的组件来实现GIS的基本功能，采用可视化开发工具，进行集成开发。集成二次开发目前主要有OLE／DDE方式和组件式方式两种。</li>
<li>特点：<ul>
<li>GIS工具软件能够提供成熟的功能。例如：空间数据库存储、空间分析等</li>
<li>高效，便捷，不需要从底层学习具体的实现原理，易上手。</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>  1. 基于arcengine或者arcobject 
  2. 基于com（原理）
</code></pre>
</blockquote>
<h4 id="2-接口及类：特，用，概，接口应用"><a href="#2-接口及类：特，用，概，接口应用" class="headerlink" title="2. 接口及类：特，用，概，接口应用"></a>2. 接口及类：特，用，概，接口应用</h4><p>   接口的特点：</p>
<pre><code>  1. 接口的多态性：许多不同的类可以支持相同的接口
  2. 接口的继承性：所有的子类都继承了父类的接口
</code></pre>
<p>   面向接口编程：</p>
<ul>
<li>接口定义了能做什么，类定义了该怎么做。类实现了接口中的方法。</li>
<li>接口描述了一系列外部可见操作</li>
<li>接口具有类内置的一组属性和方法</li>
</ul>
<p>   Com类代码：</p>
<ul>
<li>接口模块：定义方法和属性</li>
<li>类模块：实现方法和属性</li>
</ul>
<blockquote>
<p>COM 对象的接口是抽象的，接口与类不同。因为接口没有 任何的实现，所以不能通过自身实例化。因为接口没有任何的实现，所以不能通过自身实例化。接口由具体的类来实现由具体的类来实现，功能用接口抽象地模拟，并且用类去真正实现。</p>
</blockquote>
<h6 id="地图接口"><a href="#地图接口" class="headerlink" title="地图接口"></a>地图接口</h6><pre><code>  1. ILayer接口:所有图层类都可以实现该接口，定义了所有图层公共的方法和属性。
     - Name属性:返回图层名称；
     - MaximumScale属性:显示或设置图层可以出现的最大比例尺；
     - MinmumScale属性:显示或设置图层可以出现的最小比例尺；
     - ShowTips属性：指示当鼠标放在图层中某个要素上时，是否出现Tips;
     - SpatialReference属性：设置图层的空间参考。
  2. IFeatureLayer接口:主要用于设置要素图层的数据源（FeatureClass）
     - DataSourceType属性：返回图层的数据源类型；
     - Search方法：通过2个参数，过滤器（IQueryFilter类型的对象）和布尔值（用于返回要素游标是否循环，返回一个Icursor对象）
</code></pre>
<blockquote>
<p>IFeatureLayer接口继承自Ilayer接口，IFeatureClass接口继承自Iclass接口。</p>
<p>FeatureLayer可以创建自己的对象，FeatureClass不行</p>
</blockquote>
<h6 id="类"><a href="#类" class="headerlink" title="类"></a>类</h6><ol>
<li><p>Version类库：ArcEngine 10.0新出的类库，包含里将独立应用程序绑定到特定的ArcGIS系列产品的函数和方法。</p>
</li>
<li><p>System：ystem库是ArcGIS框架中最底层的一个库，它包含了一些被其他库使用的一些基础组件。 </p>
</li>
<li><p>SystemUI：SystemUI库定义了一些在ArcGIS中被用户界面组件使用的类型。象ICommand和ITool这样的接口就在这里定义。</p>
</li>
<li><p>Geometry：几何库包含了核心的几何对象，比如点，面，线等。在几何库中还定义和实现了空间参考的对象，包括投影坐标系和几何坐标系。</p>
</li>
<li><p>Display：显示库包含了支持在输出设备上显示图形的组件，屏幕显示、符号、颜色、显示交互（Feedback)等都在这个库中定义。</p>
</li>
<li><p>Server：提供了连接、管理ArcGIS Server的核心类，如IServerObjectManager、IServerObject等，其他类库的对象可以通过ArcGIS Server的IServerContext进行远程创建。</p>
</li>
<li><p>Output：提供了将MapControl和PagelayoutControl中的地图输出到打印机以及其他设备文件中。</p>
</li>
</ol>
<h4 id="3-对象模型图：类和关系，分别有什么特点"><a href="#3-对象模型图：类和关系，分别有什么特点" class="headerlink" title="3. 对象模型图：类和关系，分别有什么特点"></a>3. 对象模型图：类和关系，分别有什么特点</h4><ol>
<li><p>类</p>
<ul>
<li>抽象类：不能用于创建对象，对子类例程进行了规定（通过类型继承）。</li>
<li>普通类：不能直接创建对象，但可以作为另一个类的属性或者通过另一个类的实例化来创建对象。</li>
<li>组件类：可以直接创建对象。</li>
</ul>
</li>
<li><p>关系</p>
<ul>
<li><p>关联关系：表示类之间的关系。关联的两端都定义了多样性。</p>
</li>
<li><p>组成关系：是一种“整体类”对象控制着“部分类”对象的生命期关系。</p>
</li>
<li><p>类型继承关系：定义共享父类的属性和方法，同时又具有了自己独特的属性和方法的特定对象类。</p>
</li>
<li><p>实例化关系：表示某个类的对象具有创建另一个类的对象的方法。</p>
</li>
<li><p>N元关系：表示两个以上的类相互关联。在各个关联分支的交叉点上放置一个菱形。</p>
</li>
<li><p>多样性关系：是对能于另一个对象关联的对象数目的一种限制。关联和组成关系的两端都定义了多样性。</p>
<img src="https://img-blog.csdnimg.cn/20191106115227332.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RhbkJvX0M=,size_16,color_FFFFFF,t_70" style="zoom:67%;" /></li>
</ul>
<h5 id="抽象类-AbstractClass-："><a href="#抽象类-AbstractClass-：" class="headerlink" title="抽象类(AbstractClass)："></a>抽象类(AbstractClass)：</h5><ol>
<li><p>不能创建或实例化</p>
<ol start="2">
<li>抽象类永远不能有实例</li>
</ol>
</li>
<li><p>为子类定义了泛化（general）</p>
<ol start="4">
<li>子类集成了抽象类的接口</li>
</ol>
<blockquote>
<p>抽象类的OMD 符号: 2维灰色矩形</p>
</blockquote>
</li>
</ol>
<h5 id="普通类-可实例化类-Class"><a href="#普通类-可实例化类-Class" class="headerlink" title="普通类/可实例化类 (Class)"></a>普通类/可实例化类 (Class)</h5><ol>
<li><p>不能创建或实例化</p>
</li>
<li><p>抽象类永远不能有实例</p>
</li>
<li><p>为子类定义了泛化（general）</p>
</li>
<li><p>子类集成了抽象类的接口</p>
<p>IRow pNewRow；</p>
<pre><code> ITable  pTable;
</code></pre>
<p>pNewRow  = pTable.CreateRow();</p>
<pre><code> IRow row = table.CreateRow();
</code></pre>
<blockquote>
<p>实例化类的OMD符号： 3维白色的矩形</p>
</blockquote>
</li>
</ol>
<h5 id="组件类-可创建的类-CoClass"><a href="#组件类-可创建的类-CoClass" class="headerlink" title="组件类/可创建的类(CoClass)"></a>组件类/可创建的类(CoClass)</h5><ol>
<li><p>可以创建:使用 New关键字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IMap pmap = new Map();</span><br></pre></td></tr></table></figure></li>
<li><p>实例化: 从其它对象获得</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Imap pMap;</span><br><span class="line">pMap = m_MapDocument.get_Map(i);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可创建类的OMD符号：3维灰色矩形         </p>
</blockquote>
</li>
</ol>
</li>
<li><h4 id="AE控件有哪些，分类特点"><a href="#AE控件有哪些，分类特点" class="headerlink" title="AE控件有哪些，分类特点"></a>AE控件有哪些，分类特点</h4><ol>
<li>制图控件: MapControl 和PageLayoutControl</li>
<li>框架控件: TOCControl（内容表控件） 和ToolbarControl(工具条控件)–（buddy控件捆绑）</li>
<li>许可控件：LicenseControl（启动时执行License初始化）</li>
<li>符号控件:SymbologyControl</li>
<li>Reader Control: ReaderControl和ReaderControl</li>
<li>三维控件：GlobeControl和SceneControl </li>
</ol>
</li>
<li><h4 id="矢量数据集相关类的关系"><a href="#矢量数据集相关类的关系" class="headerlink" title="矢量数据集相关类的关系"></a>矢量数据集相关类的关系</h4><ol>
<li>矢量数据数据的加载，分析，查询</li>
</ol>
<p>接口：</p>
<pre><code>  1. **IWorkspaceFactory**：创建工作工厂

  2. **IWorkspace**：工作化工作空间
     3. **IFeatureWorkspace**：接口转换为要素工作空间
     4. **IFeatureClass**：创建featureClass
     5. **IFeatureLayer**：创建要素图层
     6. **IMap**：接收AxMapControl中的地图对象
</code></pre>
<p>类：</p>
<ol>
<li><strong>ShapefileWorkspaceFactory</strong>：作为子类创建工作空间</li>
<li><strong>FeatureLayer</strong>：创建要素图层用于接收打开的shpfile文件的featureClass，作为图层，只是表现形式，真正的数据在FeatureClass中。</li>
<li><strong>FeatureClass</strong>是从Dataset继承过来的,FeatureClass是有空间数据字段的数据集。</li>
</ol>
</li>
</ol>
<h2 id="程序流程（简答）"><a href="#程序流程（简答）" class="headerlink" title="程序流程（简答）"></a>程序流程（简答）</h2><h5 id="1-数据访问，添加矢量"><a href="#1-数据访问，添加矢量" class="headerlink" title="1. 数据访问，添加矢量"></a>1. 数据访问，添加矢量</h5><p>矢量加载：</p>
<ol>
<li>获取文件路径和文件名称</li>
<li>创建地理空间工厂WorkspaceFactory（怎么创建）</li>
<li>实例化地理空间Workspace（怎么实例化）</li>
<li>获取FeatureClass</li>
<li>创建要素图层FeatureLayer</li>
<li>为要素图层定义数据集FeatureClass</li>
<li>添加至地图控件</li>
<li>刷新地图视图</li>
</ol>
<h5 id="2-空间数据显示—图层渲染"><a href="#2-空间数据显示—图层渲染" class="headerlink" title="2. 空间数据显示—图层渲染"></a>2. 空间数据显示—图层渲染</h5><pre><code>  1. 抽象类：Symbol，MarkerSymbol，LineSymbol，FillSymbol
  2. 组件类：
         1. RgbColor：颜色
         2. SimpleMarkerSymbol，SimplelineSymbol，SimplefillSymbol：简单点线面符号
         3. SimpleRenderer：简单渲染
</code></pre>
<ol>
<li>实例化<code>ISimpleMarkerSymbol</code>，提供简单点符号</li>
<li>实例化<code>ISimpleRenderer</code>，提供简单渲染器</li>
<li>获取渲染图层赋值给<code>IGeoFeatureLayer</code>，提供要素图层对成员控制地理特征渲染的入口,获取渲染图层</li>
<li>调用<code>pGeoFeatureLayer.Renderer</code>属性赋值渲染器</li>
<li>刷新地图视图</li>
</ol>
<h5 id="3-元素添加至地图"><a href="#3-元素添加至地图" class="headerlink" title="3. 元素添加至地图"></a>3. 元素添加至地图</h5><ol>
<li>获取<code>pagelayerout</code>对象、活动视图<code>pActiveView </code>、图形容器<code>pGraphicsContainer</code>、地图窗口<code>MapFrame</code></li>
<li>创建<code>UID</code>对象，设置<code>value</code></li>
<li>通过<code>MapFrame</code>的<code>CreateSurroundFrame(uid,null)</code>方法创建<code>mapSurroundFrame</code></li>
<li>实例化一个区域几何<code>envelope</code>（包裹元素的盒子）。通过<code>PutCoords(xmin, ymin, xmax, ymax)</code>方法设置地图上的位置</li>
<li>通过<code>mapSurroundFrame</code>获取<code>Element</code>，设置框架的几何体属性<code>Geometry</code>为区域几何对象<code>envelope</code></li>
<li>通过图形容器<code>pGraphicsContainer</code>的<code>AddElement(Element，ZOrder)</code>方法把地图要素添加地图布局。</li>
<li>刷新视图。</li>
</ol>
<p>接口：</p>
<ol>
<li>IGraphicsContainer：管理map上的Element对象，获取图形容器</li>
<li>IMapFrame：访问控制地图元素对象的成员</li>
<li>IMapSurroundFrame：获取或更新存储在帧中的环绕对象（指北针、比例尺条或图例）</li>
<li>IEnvelope：地物的外接矩形，用来放置元素。</li>
<li>IElement：通过这一属性设置该元素的外接矩形在地图上的位置。所有图形元素和框架元素都实现的接口，可以确定元素的Geometry属性。</li>
</ol>
<p>类：</p>
<ol>
<li>UID用来设置元素类型的编码</li>
<li>MapFrame： 用于显示地图的图形元素。</li>
<li>MapSurroundFrame：用于显示地图包围的图形元素。</li>
<li>Envelope：包络线，是每个几何形体的最小外接矩形。每个Geometry都拥有一个Envelope</li>
<li>Element：抽象类</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public void add(string value,double xmin,double ymin, double xmax, double ymax)</span><br><span class="line">&#123;</span><br><span class="line">    //获取图形容器</span><br><span class="line">    IGraphicsContainer graphicsContainer = pageLayoutControl.PageLayout as IGraphicsContainer;</span><br><span class="line">    </span><br><span class="line">    //根据MapSurround的uid，创建相应的MapSurroundFrame和MapSurround</span><br><span class="line">    UID uid = new UID();</span><br><span class="line">    uid.Value = value;</span><br><span class="line">    IMapFrame mapFrame = pageLayoutControl.PageLayout as IMapFrame;</span><br><span class="line">    IMapSurroundFrame mapSurroundFrame = mapFrame.CreateSurroundFrame(uid, null);</span><br><span class="line">    </span><br><span class="line">    //为要素实例化一个区域几何。元素的外接矩形</span><br><span class="line">    envelope = new Envelope() as IEnvelope;</span><br><span class="line">    envelope.PutCoords(xmin, ymin, xmax, ymax);</span><br><span class="line">       </span><br><span class="line">    //获取Element，用来设置框架的几何体属性</span><br><span class="line">    IElement eement = mapSurroundFrame as IElement;</span><br><span class="line">    </span><br><span class="line">    //geometry属性控制区域几何在地图上的位置</span><br><span class="line">    element.Geometry = envelope;</span><br><span class="line">    </span><br><span class="line">    graphicsContainer.AddElement(element, 0);  </span><br><span class="line">    activeView.Refresh();</span><br><span class="line">    pagelayoutcontrol.Refresh();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-属性查询"><a href="#4-属性查询" class="headerlink" title="4. 属性查询"></a>4. 属性查询</h5><h6 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h6><ol>
<li>获取数据源<code>FeatureClass</code></li>
<li>循环给每一列写字段名</li>
<li>获取查询返回的游标，<code>null</code>代表没有查询条件，返回整个表</li>
<li>用<code>IFeature</code>接收指针指向的数据</li>
<li>将指针指向第一个要素属性行</li>
<li>如果<code>pFeature</code>不为空则循环7，8，9步</li>
<li>获取表中的新行，并将引用赋值给<code>DataRow</code></li>
<li>为每一个属性单元格赋值</li>
<li>游标指向下一行要素并重新赋值给<code>pFeature</code></li>
<li>将<code>DataTable</code>赋值给<code>dataGridView</code>的数据源</li>
</ol>
<h6 id="类："><a href="#类：" class="headerlink" title="类："></a>类：</h6><ol>
<li>QueryFilter：过滤数据通过属性值或者属性之间的关系</li>
<li>QueryDef：代表了数据库中基于一个或多个表、要素类的进行的属性查询，通过这个对象，用户可以在多个表间建立连接，并且保证在这个连接基础上的查询可以实现。</li>
<li>FeatureCursor：普通类，通过<code>pFeatureClass.Search(filter, false);</code>实例化</li>
</ol>
<h6 id="接口："><a href="#接口：" class="headerlink" title="接口："></a>接口：</h6><ol>
<li>IFeatureClass：数据源</li>
<li>IQueryFilter：用于属性查询</li>
<li>IFeatureCursor：查询返回的游标</li>
<li>IFeature：要素，返回游标中要素集单位</li>
</ol>
<h5 id="5-空间查询"><a href="#5-空间查询" class="headerlink" title="5. 空间查询"></a>5. 空间查询</h5><h6 id="步骤：-1"><a href="#步骤：-1" class="headerlink" title="步骤："></a>步骤：</h6><ol>
<li>获取<code>pFeatureLayer</code></li>
<li>实例化过滤器<code>pSpatialFilter</code></li>
<li>创建<code>geometry</code>，用来装载框选范围</li>
<li>将框选几何<code>geometry</code>赋给<code>pSpatialFilter</code></li>
<li>设置空间范围的查询条件（从空间查询窗体获得）</li>
<li>实例化查询接口<code>pfeatureSelection</code></li>
<li>调用查询方法<code>SelectFeatures(过滤器, esriSelectionResultEnum.esriSelectionResultNew, false);</code>实现高亮</li>
<li>刷新图层</li>
</ol>
<h6 id="接口：-1"><a href="#接口：-1" class="headerlink" title="接口："></a>接口：</h6><ol>
<li>IFeatureLayer：当前的要素图层，用于接口转换</li>
<li>ISpatialFilter：过滤器，用来设置空间范围的查询条件</li>
<li>IGeometry：几何类型，获取框选范围</li>
<li>IFeatureSelection：查询接口，用于查询，没有返回值，实现高亮</li>
</ol>
<h6 id="类：-1"><a href="#类：-1" class="headerlink" title="类："></a>类：</h6><ol>
<li>FeatureLayer：组件类，要素图层</li>
<li>SpatialFilter：组件类，过滤器</li>
<li>Geometry：普通类，通过<code>mapControl.TrackRectangle();</code>实例化，几何类型</li>
</ol>
<h2 id="程序设计题"><a href="#程序设计题" class="headerlink" title="程序设计题"></a>程序设计题</h2><h4 id="1-面向接口的编程及接口转换"><a href="#1-面向接口的编程及接口转换" class="headerlink" title="1. 面向接口的编程及接口转换"></a>1. 面向接口的编程及接口转换</h4><h4 id="2-接口的继承"><a href="#2-接口的继承" class="headerlink" title="2. 接口的继承"></a>2. 接口的继承</h4><h4 id="3-图层的显示及渲染"><a href="#3-图层的显示及渲染" class="headerlink" title="3. 图层的显示及渲染"></a>3. 图层的显示及渲染</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">///</span><br><span class="line">//Shp</span><br><span class="line">///</span><br><span class="line">OpenFileDialog pOpenfileDialog = new OpenFileDialog();</span><br><span class="line">if (pOpenfileDialog.ShowDialog() == DialogResult.OK)</span><br><span class="line">&#123;</span><br><span class="line">    string path = pOpenfileDialog.FileName;</span><br><span class="line">    bool shp = path.EndsWith(&quot;.shp&quot;);</span><br><span class="line">    if (shp)</span><br><span class="line">        openShpFile(path);</span><br><span class="line">&#125;</span><br><span class="line">private void openShpFile(string file)</span><br><span class="line">&#123;</span><br><span class="line">    int index = 0;</span><br><span class="line">    //获取最后一个“\\”时的索引位置</span><br><span class="line">    index = file.LastIndexOf(&quot;\\&quot;);</span><br><span class="line">    //获得shp文件的路径</span><br><span class="line">    string filePath = file.Substring(0, index);</span><br><span class="line">    //获得shp文件名</span><br><span class="line">    string fileName = file.Substring(index + 1, file.Length - (index + 1));</span><br><span class="line">    //由工作空间工厂创建shp工作空间工厂类</span><br><span class="line">    IWorkspaceFactory pWorkspaceFactory = new ShapefileWorkspaceFactory();</span><br><span class="line">    //打开工作空间</span><br><span class="line">    IWorkspace pWorkspace = pWorkspaceFactory.OpenFromFile(filePath, 0);</span><br><span class="line">    //转换工作空间为要素工作空间</span><br><span class="line">    IFeatureWorkspace pFeatureWorkspace = pWorkspace as IFeatureWorkspace;</span><br><span class="line">    //打开要素类</span><br><span class="line">    IFeatureClass pFC = pFeatureWorkspace.OpenFeatureClass(fileName);</span><br><span class="line">    //创建要素图层</span><br><span class="line">    IFeatureLayer pFLayer = new FeatureLayer();</span><br><span class="line">    //设置图层的featureclass为上面打开的文件</span><br><span class="line">    pFLayer.FeatureClass = pFC;</span><br><span class="line">    //设置图层的名称</span><br><span class="line">    pFLayer.Name = pFC.AliasName;</span><br><span class="line">    //转换featurelayer为layer</span><br><span class="line">    ILayer pLayer = pFLayer as ILayer;</span><br><span class="line">    IMap pMap = mapControl.Map;</span><br><span class="line">    //添加图层</span><br><span class="line">    pMap.AddLayer(pLayer);</span><br><span class="line">    //刷新</span><br><span class="line">    mapControl.ActiveView.Refresh();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">///</span><br><span class="line">//渲染</span><br><span class="line">///</span><br><span class="line"></span><br><span class="line">//简单渲染，点符号</span><br><span class="line">public static void easy_point(string filename, IRgbColor point_rgb, int width)</span><br><span class="line">&#123;</span><br><span class="line">     //实例化ISimpleFillSysmbol变量, 提供简单的填充符号类型</span><br><span class="line">	ISimpleMarkerSymbol pSimplemarkerSymbol = new SimpleMarkerSymbol();</span><br><span class="line">     pSimplemarkerSymbol.Color = point_rgb;</span><br><span class="line">     pSimplemarkerSymbol.OutlineSize = width;</span><br><span class="line">     //实例化简单渲染变量</span><br><span class="line">     ISimpleRenderer pSimpleRender = new SimpleRenderer();</span><br><span class="line">     //设置pSimpleRender的符号样式</span><br><span class="line">     pSimpleRender.Symbol = pSimplemarkerSymbol as ISymbol;</span><br><span class="line">	Render_tool(pSimpleRender, filename);</span><br><span class="line">&#125;</span><br><span class="line">private static void Render_tool(ISimpleRenderer pSimpleRenderer, string filename)</span><br><span class="line">&#123;</span><br><span class="line">      //提供要素图层对成员控制地理特征渲染的入口,获取渲染图层</span><br><span class="line">      IGeoFeatureLayer pGeoFeatureLayer = getGeoLayer(filename);</span><br><span class="line">      if (pGeoFeatureLayer != null)</span><br><span class="line">          //调用Renderer属性, 具体说明如何通过图层要素渲染器渲染图层</span><br><span class="line">          pGeoFeatureLayer.Renderer = pSimpleRenderer as IFeatureRenderer;</span><br><span class="line">      mapControl.ActiveView.Refresh();</span><br><span class="line">&#125;</span><br><span class="line">public static IGeoFeatureLayer getGeoLayer(string layerName)</span><br><span class="line">&#123;</span><br><span class="line">      ILayer pLayer; //定义图层</span><br><span class="line">      IGeoFeatureLayer pGeoFeatureLayer; //定义要素图层</span><br><span class="line">      for (int i = 0; i &lt; CSR_mapControl.LayerCount; i++)</span><br><span class="line">      &#123;</span><br><span class="line">           pLayer = CSR_mapControl.get_Layer(i);</span><br><span class="line">           //若当前图层不为空且与与layerName的值相同</span><br><span class="line">           if (pLayer != null &amp;&amp; pLayer.Name == layerName)</span><br><span class="line">           &#123;</span><br><span class="line">                pGeoFeatureLayer = pLayer as IGeoFeatureLayer;</span><br><span class="line">                return pGeoFeatureLayer;</span><br><span class="line">           &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      return null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">///</span><br><span class="line">//Tiff</span><br><span class="line">///</span><br><span class="line"></span><br><span class="line">//工作空间实例化</span><br><span class="line">IWorkspaceFactory pRasterWsF = new RasterWorkspaceFactory();</span><br><span class="line">IWorkspace pWs = pRasterWsF.OpenFromFile(RasterPath, 0);</span><br><span class="line">IRasterWorkspace pRasterWs = pWs as IRasterWorkspace;</span><br><span class="line">IRasterDataset pRasterDS = pRasterWs.OpenRasterDataset(RasterName);</span><br><span class="line">//影像金字塔的判断和创建</span><br><span class="line">IRasterPyramid pRasterPyramid = pRasterDS as IRasterPyramid;</span><br><span class="line">if ((pRasterPyramid != null) &amp;&amp; (!pRasterPyramid.Present))</span><br><span class="line">&#123;</span><br><span class="line">    pRasterPyramid.Create();</span><br><span class="line">&#125;</span><br><span class="line">//新建栅格图层</span><br><span class="line">IRasterLayer pRasterLayer = new RasterLayer();</span><br><span class="line">pRasterLayer.CreateFromRaster(pRasterDS.CreateDefaultRaster());</span><br><span class="line">IMap pmap = mapControl.Map;</span><br><span class="line">//加载显示</span><br><span class="line">pmap.AddLayer(pRasterLayer);</span><br><span class="line">mapControl.ActiveView.Refresh();</span><br></pre></td></tr></table></figure>



<h4 id="4-属性查询-1"><a href="#4-属性查询-1" class="headerlink" title="4. 属性查询"></a>4. 属性查询</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public static DataTable getFeatureLayerTable(IFeatureLayer pFeatureLayer)</span><br><span class="line">&#123;</span><br><span class="line">    //获取数据源FeatureClass</span><br><span class="line">    IFeatureClass pFeatureClass = pFeatureLayer.FeatureClass;</span><br><span class="line">    DataTable dt = new DataTable();</span><br><span class="line">    for (int i = 0; i &lt; pFeatureClass.Fields.FieldCount; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        //循环给每一列写字段名</span><br><span class="line">    	dt.Columns.Add(pFeatureClass.Fields.get_Field(i).Name);</span><br><span class="line">    &#125;</span><br><span class="line">    //获取查询返回的游标，null代表没有查询条件，返回整个表</span><br><span class="line">    IFeatureCursor pFeatureCursor = pFeatureClass.Search(null, false);</span><br><span class="line">    //将指针指向第一个要素属性行</span><br><span class="line">    IFeature pFeature = pFeatureCursor.NextFeature();</span><br><span class="line">    while (pFeature != null)</span><br><span class="line">    &#123;</span><br><span class="line">        //获取表中的新行，并将引用赋值给DataRow</span><br><span class="line">        DataRow dataR = dt.Rows.Add();</span><br><span class="line">        for (int j = 0; j &lt; pFeatureClass.Fields.FieldCount; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            //为每一个属性单元格赋值</span><br><span class="line">            if (pFeature.get_Value(j) == null)</span><br><span class="line">                dataR[j] = pFeatureClass.ShapeType.ToString();</span><br><span class="line">            else</span><br><span class="line">                dataR[j] = pFeature.get_Value(j);</span><br><span class="line">        &#125;</span><br><span class="line">        //游标指向下一行要素</span><br><span class="line">        pFeature = pFeatureCursor.NextFeature();</span><br><span class="line">    &#125;</span><br><span class="line">    return dt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-空间查询-1"><a href="#5-空间查询-1" class="headerlink" title="5. 空间查询"></a>5. 空间查询</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">IFeatureLayer pFeatureLayer = pLayer as IFeatureLayer;</span><br><span class="line"></span><br><span class="line">//实例化一个过滤器，用来设置空间范围的查询条件</span><br><span class="line">ISpatialFilter pSpatialFilter = new SpatialFilter();</span><br><span class="line">IGeometry geometry = mapControl.TrackRectangle();</span><br><span class="line">//将几何范围赋值给pSpatialFilter</span><br><span class="line">pSpatialFilter.Geometry = geometry;</span><br><span class="line">//设置空间范围的查询条件</span><br><span class="line">pSpatialFilter.SpatialRel = esriSpatialRelEnum.esriSpatialRelIntersects;</span><br><span class="line">//实例化查询接口</span><br><span class="line">IFeatureSelection pfeatureSelection = pFeatureLayer as IFeatureSelection;</span><br><span class="line">//实现高亮</span><br><span class="line">pfeatureSelection.SelectFeatures(pSpatialFilter, esriSelectionResultEnum.esriSelectionResultNew, false);</span><br><span class="line">mapControl.Refresh();//地图刷新</span><br></pre></td></tr></table></figure>

<h2 id="分值"><a href="#分值" class="headerlink" title="分值"></a>分值</h2><ol>
<li>填空：1*15</li>
<li>选择：2*10</li>
<li>简答：基本概念、总结及功能流程 4*5</li>
<li>程序阅读：改错、对象模型图 5*3</li>
<li>程序设计：2*15</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/22/GIS%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%20%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" data-id="ckreqntjz0029r07kgvea6192" data-title="GIS程序设计 知识总结" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/07/22/GIS%E5%A4%8D%E4%B9%A0%E3%80%90I%E3%80%91/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          GIS复习【I】
        
      </div>
    </a>
  
  
    <a href="/2021/07/22/GIS-Experiment3/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">GIS-Experiment3</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/07/22/%E6%9C%80%E5%A4%A7%E6%B5%81%E9%97%AE%E9%A2%98------Ford-Fulkerson%E7%AE%97%E6%B3%95%EF%BC%88%E5%A2%9E%E5%B9%BF%E8%B7%AF%E5%BE%84%EF%BC%89/">最大流问题------Ford-Fulkerson算法（增广路径）</a>
          </li>
        
          <li>
            <a href="/2021/07/22/%E5%9C%A8Ubuntu%E4%B8%8A%E5%AE%89%E8%A3%85java%E7%8E%AF%E5%A2%83/">在Ubuntu上安装java环境</a>
          </li>
        
          <li>
            <a href="/2021/07/22/%E9%81%A5%E6%84%9F%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8%E3%80%90%E2%85%A1%E3%80%91/">遥感原理与应用【Ⅱ】</a>
          </li>
        
          <li>
            <a href="/2021/07/22/%E9%81%A5%E6%84%9F%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8%20%E3%80%90I%E3%80%91/">遥感原理与应用 【I】</a>
          </li>
        
          <li>
            <a href="/2021/07/22/%E6%B8%B2%E6%9F%93---%E5%94%AF%E4%B8%80%E5%80%BC%E6%B8%B2%E6%9F%93/">渲染---唯一值渲染</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 Eno·feng<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>